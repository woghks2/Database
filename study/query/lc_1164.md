# 리트코드 : 1164. Product Price at a Given Date
* https://leetcode.com/problems/product-price-at-a-given-date/description/
<br>

---

## 문제
```text
문제
table: Products

+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| new_price     | int     |
| change_date   | date    |
+---------------+---------+
(product_id, change_date) is the primary key (combination of columns with unique values) of this table.
Each row of this table indicates that the price of some product was changed to a new price at some date.
 

Write a solution to find the prices of all products on 2019-08-16. Assume the price of all products before any change is 10.

Return the result table in any order.

The result format is in the following example.

 

Example 1:

Input: 
Products table:
+------------+-----------+-------------+
| product_id | new_price | change_date |
+------------+-----------+-------------+
| 1          | 20        | 2019-08-14  |
| 2          | 50        | 2019-08-14  |
| 1          | 30        | 2019-08-15  |
| 1          | 35        | 2019-08-16  |
| 2          | 65        | 2019-08-17  |
| 3          | 20        | 2019-08-18  |
+------------+-----------+-------------+
Output: 
+------------+-------+
| product_id | price |
+------------+-------+
| 2          | 50    |
| 1          | 35    |
| 3          | 10    |
+------------+-------+
```

<br>

## 문제 풀이

### **MySQL**
```SQL
with temp as (
    select *, min(order_date) as d1, min(customer_pref_delivery_date) as d2
    from delivery
    group by customer_id
),
cnt_filtered as (
    select *, count(*) as cnt_f
    from temp
    where d1 = d2
),
cnt_all as (
    select *, count(*) as cnt_a
    from temp
)

select round(100*cnt_f/cnt_a,2) as immediate_percentage 
from cnt_all, cnt_filtered
```

* 각 유저별로 첫 주문을 가져오면 된다.
* 주문 날짜, 발송 날짜의 최소값이 서로 같은 쿼리를 찾는다.
* 두 테이블의 row를 count로 세주고 roundv
  
### **Pandas**
```python
import pandas as pd

def immediate_food_delivery(delivery: pd.DataFrame) -> pd.DataFrame:
    temp = delivery.groupby('customer_id').agg(d1=('order_date', 'min'),
                                               d2=('customer_pref_delivery_date', 'min')).reset_index()
    
    answer = pd.DataFrame({'immediate_percentage':
                            [round(len(temp[temp['d1']==temp['d2']])*100/len(temp),2)]})
    return answer
```

* groupby + agg로 위 풀이랑 비슷하게 주문날짜, 배송날짜의 min값을 가져온다.
* pandas에서는 len으로 바로 처리한다.
  
<br>

### **코멘트**
* 노트북 바꾸고, 시험이랑 일이랑 이것저것 하다보니까 너무 쉬어버렸다...
* 파이썬에서 groupby + agg + 컬럼설정 이 부분 연습하기
